# File generated by Wizard 2.9.0 on Jun 24, 2025.  # 文件由Wizard 2.9.0于2025年6月24日生成

processor  WEAPON_RELEASE WSF_SCRIPT_PROCESSOR  # 定义武器释放处理器，使用脚本处理器类型
   update_interval  1 s  # 更新间隔为1秒
   script_variables  # 脚本变量定义
      string weaponName = "";  # 武器名称字符串变量，初始为空
      Map<string,bool> isEngage = Map<string,bool>();  # 交战状态映射表，键为目标名称，值为是否已交战
      int engagaCount = 5;  # 交战数量限制为5（注意：变量名拼写错误，应为"engageCount"）
   end_script_variables  # 结束脚本变量定义
   
   script bool fireEnemy(WsfTrack tTrack, string wpName){  # 定义开火函数，参数为目标航迹和武器名称，返回是否成功
      bool isSuccess = false;  # 初始化成功标志为false
      WsfWeapon tempWeapon = PLATFORM.Weapon(wpName);  # 获取平台指定名称的武器
      if(tempWeapon.IsValid()  # 如果武器有效
      && tempWeapon.QuantityRemaining()>0  # 且武器剩余数量大于0
      && PLATFORM.Altitude() > 9000  # 且平台高度大于9000米
      && PLATFORM.AuxDataDouble("strikeDistance") > PLATFORM.GroundRangeTo(tTrack)){  # 且打击距离大于到目标的距离
        isSuccess = tempWeapon.FireSalvo(tTrack,1);  # 发射齐射，目标为tTrack，数量为1
        writeln("T = ",TIME_NOW,",`",PLATFORM.Name() ,"`  launches the missile `",wpName,"` to bomb `", tTrack.TargetName(),"` with isSuccess = ",isSuccess);  # 输出发射信息
      }
      return isSuccess;  # 返回是否成功
   }
   end_script  # 结束脚本定义
   
   on_update  # 更新事件
      WsfLocalTrackList track_list = PLATFORM.MasterTrackList();  # 获取平台主航迹列表
      int track_count = track_list.Count();  # 获取航迹数量（注意：此变量定义但未使用）
      for(int i = 0; i < engagaCount; i += 1 ){  # 循环处理前engagaCount个航迹
         WsfTrack tTrack = track_list.TrackEntry(i);  # 获取第i个航迹
         if(!tTrack.IsValid())continue;  # 如果航迹无效则跳过
         string track_name = tTrack.TargetName();  # 获取目标名称
         if(isEngage[track_name])continue;  # 如果该目标已交战则跳过
         if(!fireEnemy(tTrack,weaponName))continue;  # 如果开火失败则跳过
            isEngage[track_name] = true;  # 标记该目标已交战
      }
   end_on_update  # 结束更新事件
end_processor  # 结束处理器定义
